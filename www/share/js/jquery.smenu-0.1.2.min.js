/*!
 * sMenu - v0.1.2 - 2015-09-04
 * http://archive.sdn21.com/archive/js/smenu/
 * Copyright (c) 2014 Ma Yong Min
 * Licensed MIT (http://archive.sdn21.com/archive/js/smenu/LICENSE-MIT)
 */

(function($){$.sMenu={version:"0.1.2",curr:0};$.fn.sMenu=function(options){var opt=$.extend(true,{},$.fn.sMenu.defaults,options);this.each(function(){var obj_menu=$(this);var obj_ul=$("ul",obj_menu);var obj_li=$("> li",obj_ul);var obj_link=$("> a",obj_li);var max_depth=3;var timer=null;var is_open=false;var img_arr={"off":new Array,"on":new Array,"hover":new Array};var str_selector="> ul > li";for(var i=1;i<=max_depth;i++){var obj=$(str_selector,obj_menu);if(obj.length>0){obj.addClass(opt.depth_class+
"-"+i);str_selector+="> ul > li"}else{max_depth=i-1;break}}var getDepth=function(obj){var depth=0;for(var i=1;i<=max_depth;i++)if(obj.hasClass(opt.depth_class+"-"+i)){depth=i;break}return depth};var setOn=function(){var str_selector="";for(var i=1;i<=max_depth;i++){var on_idx=eval("opt.on_menu"+i)-1;if(on_idx>-1){str_selector+="> ul > li:eq("+on_idx+")";$(str_selector,obj_menu).addClass(opt.on_class)}else break}if(opt.flag_use_img){var cnt=obj_link.length;for(var i=0;i<cnt;i++){var obj=obj_link.eq(i).parent("li");
if(obj.hasClass(opt.on_class))replaceImage(obj_link.eq(i).find("> img"),"on");else replaceImage(obj_link.eq(i).find("> img"),"off")}}opt.onCall()};var replaceImage=function(obj,flag){var arr=new Array;arr=obj.attr("class").split("img_arr_");arr=arr[1].split(" ");var img_idx=arr[0];var img_src=obj.attr("src");var new_src=img_arr[flag][img_idx];if(img_src!=new_src)obj.attr("src",new_src)};var setHover=function(obj){var depth=getDepth(obj);if(depth>0){var depth_class=opt.depth_class+"-"+depth;var obj_off=
obj.siblings("li").find("li").andSelf();obj_off.removeClass(opt.hover_class);obj.addClass(opt.hover_class);if(opt.flag_use_img){var cnt=obj_off.length;for(var i=0;i<cnt;i++)if(obj_off.eq(i).hasClass(opt.on_class))replaceImage(obj_off.eq(i).find("> a > img"),"on");else replaceImage(obj_off.eq(i).find("> a > img"),"off");replaceImage(obj.find("> a > img"),"hover")}}opt.hoverCall(obj,depth)};var init=function(){obj_li.removeClass(opt.hover_class);setOn()};var setImageArray=function(){var cnt=obj_link.length;
for(var i=0;i<cnt;i++){var img_src=obj_link.eq(i).find("> img").addClass("img_arr_"+i).attr("src");var last_idx=img_src.lastIndexOf(".");img_arr["off"][i]=img_src;var img_prefix=img_src.substring(0,last_idx);var img_suffix=img_src.substring(last_idx,img_src.length);img_arr["on"][i]=img_prefix+opt.on_suffix+img_suffix;img_arr["hover"][i]=img_prefix+opt.hover_suffix+img_suffix}};var close=function(){obj_menu.removeClass(opt.open_class);opt.closeCall();init();clearTimeout(timer);is_open=false};if(opt.flag_use_img)setImageArray();
if(opt.is_snb)obj_link.on("click",function(e){var obj_parent=$(this).parent("li");if(!obj_parent.hasClass(opt.hover_class)){setHover(obj_parent);if(!obj_menu.hasClass(opt.open_class)){obj_menu.addClass(opt.open_class);opt.openCall()}clearTimeout(timer);is_open=true}else{obj_parent.removeClass(opt.hover_class);var depth=getDepth(obj_parent);if(depth<2){obj_menu.removeClass(opt.open_class);opt.closeCall();clearTimeout(timer);is_open=false}}if(obj_parent.find("ul").length>0)e.preventDefault()});else{obj_link.on("mouseenter focusin",
function(e){if(!obj_menu.hasClass(opt.open_class)){obj_menu.addClass(opt.open_class);opt.openCall()}setHover($(this).parent("li"));clearTimeout(timer);is_open=true});obj_menu.on("mouseleave",function(){close()});obj_link.filter(":eq(0), :eq(-1)").on("focusout",function(e){timer=setTimeout(function(){close()},100)})}init()});return this};$.fn.sMenu.defaults={open_class:"open",on_class:"on",hover_class:"on",depth_class:"depth",flag_use_img:false,on_suffix:"_on",hover_suffix:"_on",hoverCall:function(obj,
depth){},onCall:function(){},openCall:function(){},closeCall:function(){},on_menu1:0,on_menu2:0,on_menu3:0,is_snb:false}})(jQuery);